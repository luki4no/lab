Source: [Wazuh - Deployment on Docker](https://documentation.wazuh.com/current/deployment-options/docker/index.html)

# Benutze VM

> 192.168.100.10   centos

# Anpassungen

Docker und Docker-Compose haben wir schon mit Greenbone implementiert. In diesem Dokument werde ich nur die auszuführenden Kommandos notieren; die Details finden wir auf der oben genannten öffentlichen Website.

# Docker-Host 'centos' vorbereiten
```bash
sudo sysctl -w vm.max_map_count=262144
```
```bash
echo 'vm.max_map_count = 262144' | sudo tee -a /etc/sysctl.conf
```

# Wazuh Docker-Bereitstellung (Einzelknoten)

## Klone das Wazuh-Repository auf dein System und starte die Installation. 

```bash
cd ~
```
```bash
git clone https://github.com/wazuh/wazuh-docker.git -b v4.9.2
```
```bash
cd ~/wazuh-docker/single-node/
```

## Generiere self-signed certificates für jeden Cluster-Knoten (ohne Proxy)

Wir haben ein Docker-Image erstellt, um die Zertifikatserstellung mit dem Wazuh-Certs-Gen-Tool zu automatisieren.

Führe den folgenden Befehl aus, um die gewünschten Zertifikate zu erhalten:

```bash
docker compose -f generate-indexer-certs.yml run --rm generator
```

Resultat:

```bash
[lucian@centos single-node]$ docker compose -f generate-indexer-certs.yml run --rm generator
WARN[0000] /home/lucian/wazuh-docker/single-node/generate-indexer-certs.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion
[+] Creating 1/1
 ✔ Network single-node_default  Created                                                                                   0.2s
[+] Running 5/5
 ✔ generator Pulled                                                                                                       6.4s
   ✔ 17d0386c2fff Pull complete                                                                                           3.1s
   ✔ 7ce91ec7d1d3 Pull complete                                                                                           3.7s
   ✔ 5249716d429c Pull complete                                                                                           3.7s
   ✔ d7003467fd14 Pull complete                                                                                           3.8s
The tool to create the certificates exists in Packages-dev bucket
30/11/2024 21:32:31 INFO: Generating the root certificate.
30/11/2024 21:32:31 INFO: Generating Admin certificates.
30/11/2024 21:32:31 INFO: Admin certificates created.
30/11/2024 21:32:31 INFO: Generating Wazuh indexer certificates.
30/11/2024 21:32:31 INFO: Wazuh indexer certificates created.
30/11/2024 21:32:31 INFO: Generating Filebeat certificates.
30/11/2024 21:32:31 INFO: Wazuh Filebeat certificates created.
30/11/2024 21:32:31 INFO: Generating Wazuh dashboard certificates.
30/11/2024 21:32:31 INFO: Wazuh dashboard certificates created.
Moving created certificates to the destination directory
Changing certificate permissions
Setting UID indexer and dashboard
Setting UID for wazuh manager and worker
[lucian@centos single-node]$
```

Die Zertifikate werden hier abgelegt:

```bash
sudo ls -l $HOME/wazuh-docker/single-node/config/wazuh_indexer_ssl_certs
```
```bash
[lucian@centos single-node]$ sudo ls -l $HOME/wazuh-docker/single-node/config/wazuh_indexer_ssl_certs
total 48
-r--------. 1 lucian           lucian 1704 Nov 30 22:32 admin-key.pem
-r--------. 1 lucian           lucian 1119 Nov 30 22:32 admin.pem
-r--------. 1 lucian           lucian 1708 Nov 30 22:32 root-ca.key
-r--------. 1 systemd-coredump input  1708 Nov 30 22:32 root-ca-manager.key
-r--------. 1 systemd-coredump input  1204 Nov 30 22:32 root-ca-manager.pem
-r--------. 1 lucian           lucian 1204 Nov 30 22:32 root-ca.pem
-r--------. 1 lucian           lucian 1704 Nov 30 22:32 wazuh.dashboard-key.pem
-r--------. 1 lucian           lucian 1261 Nov 30 22:32 wazuh.dashboard.pem
-r--------. 1 lucian           lucian 1704 Nov 30 22:32 wazuh.indexer-key.pem
-r--------. 1 lucian           lucian 1257 Nov 30 22:32 wazuh.indexer.pem
-r--------. 1 systemd-coredump input  1708 Nov 30 22:32 wazuh.manager-key.pem
-r--------. 1 systemd-coredump input  1257 Nov 30 22:32 wazuh.manager.pem
[lucian@centos single-node]$
```

```plaintext
Wazuh indexer:
config/wazuh_indexer_ssl_certs/root-ca.pem
config/wazuh_indexer_ssl_certs/wazuh.indexer-key.pem
config/wazuh_indexer_ssl_certs/wazuh.indexer.pem
config/wazuh_indexer_ssl_certs/admin.pem
config/wazuh_indexer_ssl_certs/admin-key.pem

Wazuh manager:
config/wazuh_indexer_ssl_certs/root-ca-manager.pem
config/wazuh_indexer_ssl_certs/wazuh.manager.pem
config/wazuh_indexer_ssl_certs/wazuh.manager-key.pem

Wazuh dashboard:
config/wazuh_indexer_ssl_certs/wazuh.dashboard.pem
config/wazuh_indexer_ssl_certs/wazuh.dashboard-key.pem
config/wazuh_indexer_ssl_certs/root-ca.pem
```




