# Voraussetzungen

Du kannst einen PXE (Preboot Execution Environment) Server auf pfSense einrichten, obwohl es keine integrierte Funktion dafür gibt. Um dies zu erreichen, musst du in der Regel zusätzliche Tools oder Pakete verwenden, um den PXE-Bootprozess zu ermöglichen. Hier ist eine allgemeine Anleitung, wie du das einrichten kannst:

### Schritte zum Einrichten von PXE auf pfSense

1. **DHCP-Server auf pfSense aktivieren** (haben wir schon):
   - Gehe zu **Services > DHCP Server**.
   - Aktiviere den DHCP-Server für die Schnittstelle, die du verwenden möchtest (normalerweise die LAN-Schnittstelle).
   - Konfiguriere die DHCP-Einstellungen, einschließlich des IP-Adressbereichs und anderer Optionen.

```plaintext
webConfigurator http://192.168.100.2/
Services > DHCP Server > LAN
```
- [x] Enable DHCP server on LAN interface
- Address Pool Range: 192.168.100.100 - 192.168.100.200
---
2. **DHCP-Optionen für PXE konfigurieren** (brauchen wir):
   - Finde im DHCP-Serverbereich den Abschnitt **DHCP Static Mappings**, um die statischen IPs für deine PXE-Clients zu definieren, falls nötig.
   - Setze die DHCP-Optionen für PXE:
     - **Option 66**: Dies sollte auf die IP-Adresse deines TFTP-Servers (wo die PXE-Bootdateien bereitgestellt werden) zeigen.
     - **Option 67**: Dies gibt den Boot-Dateinamen an, typischerweise etwas wie `pxelinux.0`.

```plaintext
webConfigurator http://192.168.100.2/
Services > DHCP Server > LAN
```
- Other DHCP Options
   - **Option 66 (TFTP Server Name)**
        - Custom DHCP Options: Display Advanced 
           - Custom Option Number: `66`
           - Custom Option Type: `IP address or host`
           - Custom Option Value: `192.168.100.2`
   - **Option 67 (Bootfile Name)**
        - Custom DHCP Options: Display Advanced 
           - Custom Option Number: `67`
           - Custom Option Type: `String`
           - Custom Option Value: `"pxelinux.0"`
---
3. **TFTP-Server installieren** (brauchen wir)
   - Stelle sicher, dass der TFTP-Server so konfiguriert ist, dass die notwendigen PXE-Bootdateien bereitgestellt werden, wie z. B. `pxelinux.0`, Kernel-Images und Initrd-Dateien.
   - pfSense hat die TFTP Funktion nich integriert, doch diese kann nachgerüstet werden. Folgendes ausführen:

Installieren:
```plaintext
webConfigurator http://192.168.100.2/
System > Package Manager > Available Packages
```

1. Search term: tftpd
2. +Install
3. Confirm

Aktivieren:
```plaintext
webConfigurator http://192.168.100.2/
Services > TFTP Server > Settings > General Options
```
- Enable TFTP service:
   - [x] Check to enable the TFTP service.
- IPv4 Only:
   - [x] Check to allow clients to connect with IPv4 only.

---
4. **PXE-Bootdateien vorbereiten** (brauchen wir):
   - Lege die notwendigen PXE-Bootdateien im TFTP-Stammverzeichnis deines TFTP-Servers ab. Dazu gehören typischerweise:
     - `pxelinux.0` (von syslinux)
     - Eine Konfigurationsdatei für den PXE-Boot (z. B. `pxelinux.cfg/default`)
     - Kernel-Images und Initrd-Dateien für die Betriebssysteme, die du bereitstellen möchtest.

> Die PXE-Bootdateien, die du verwendest, sind im Allgemeinen spezifisch für die Distribution, die du bereitstellen möchtest. Hier ist eine Übersicht:
> 
> 1. **CentOS/RHEL**:
>    - Du kannst die `pxelinux.0` und Konfigurationsdateien für CentOS oder RHEL-Installationen verwenden, wie in den vorherigen Schritten erwähnt.
>    - Du musst den Kernel (`vmlinuz`) und das Initialramdisk-Image (`initrd.img`) für die Version von CentOS oder RHEL, die du bereitstellen möchtest, beschaffen.
> 
> 2. **Debian/Ubuntu**:
>    - Für Debian oder Ubuntu würdest du normalerweise die `pxelinux.0`-Datei von Syslinux verwenden, aber die Kernel- und Initrd-Images sind unterschiedlich.
>    - Du kannst diese Dateien von den Debian/Ubuntu-Installationsmedien oder -Repositories erhalten. Die Pfade können ähnlich sein, aber die genauen Dateinamen können variieren:
>      - Debian könnte `linux` und `initrd.gz` verwenden.
>      - Ubuntu könnte `vmlinuz` und `initrd.img` haben, ähnlich wie CentOS.
> 
> 3. **Allgemeine PXE-Konfiguration**:
>    - Während `pxelinux.0` für mehrere Distributionen verwendet werden kann, müssen die Konfiguration und die Kernel-/Initrd-Images auf jede Distribution abgestimmt sein.
>    - Jede Distribution hat ihre eigenen Methoden zur Erstellung der PXE-Konfigurationsdatei, um die richtigen Bootparameter anzugeben.
> 
> ### Beispiel:
> - Wenn du PXE für sowohl CentOS als auch Debian einrichten möchtest:
>   - Kopiere `pxelinux.0` auf deinen TFTP-Server.
>   - Erstelle separate Konfigurationsdateien für jede Distribution in ihren jeweiligen Verzeichnissen in `pxelinux.cfg`, die die richtigen Kernel- und Initrd-Images für jede Distribution angeben.
> 
> Zusammenfassend lässt sich sagen, dass du `pxelinux.0` für mehrere Linux-Distributionen verwenden kannst, aber die begleitenden Bootdateien und Konfigurationen müssen mit der spezifischen Distribution übereinstimmen, die du bereitstellen möchtest.

---
5. **PXE-Boot testen** (brauchen wir):
   - Starte einen Client-Computer, der PXE unterstützt.
   - Stelle sicher, dass er so konfiguriert ist, dass er zuerst vom Netzwerk bootet.
   - Der Client sollte eine IP-Adresse vom pfSense-DHCP-Server erhalten und sich mit dem TFTP-Server verbinden, um die Bootdateien herunterzuladen.
---
### Zusätzliche Überlegungen:
- **Firewall-Regeln**: Stelle sicher, dass die Firewall-Regeln von pfSense DHCP- und TFTP-Verkehr erlauben. Möglicherweise musst du Regeln erstellen, um den UDP-Verkehr auf den Ports 67 (DHCP) und 69 (TFTP) zuzulassen.
- **Leistung**: Für Produktionsumgebungen solltest du in Betracht ziehen, einen dedizierten TFTP-Server für eine bessere Leistung und Verwaltung zu verwenden.
- **Dokumentation**: Konsultiere die pfSense-Dokumentation für spezifische Konfigurationsdetails oder Fehlersuche.

Wenn du diese Schritte befolgst, solltest du in der Lage sein, einen PXE-Server mithilfe von pfSense in deiner Netzwerkumgebung einzurichten.

