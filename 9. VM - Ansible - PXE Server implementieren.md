# PXE Playbook erstellen

```bash
sudo touch ansible-pxe-setup.yml
```
```bash
sudo nano ansible-pxe-setup.yml
```
```plaintext
---
- hosts: centos
  become: true
  tasks:
    - name: Install necessary packages
      yum:
        name:
          - dhcp-server
          - tftp-server
          - syslinux
          - httpd
          - vsftpd
        state: present

    - name: Enable and start services
      service:
        name: "{{ item }}"
        state: started
        enabled: true
      loop:
        - dhcpd
        - tftp
        - httpd

    - name: Configure DHCP server
      copy:
        dest: /etc/dhcp/dhcpd.conf
        content: |
          option domain-name "localdomain";
          option domain-name-servers 8.8.8.8, 8.8.4.4;
          default-lease-time 600;
          max-lease-time 7200;
          subnet 192.168.100.0 netmask 255.255.255.0 {
            range 192.168.100.50 192.168.100.100;
            option routers 192.168.100.2;
            filename "pxelinux.0";
            next-server 192.168.100.10;
          }

    - name: Configure TFTP server
      copy:
        dest: /etc/xinetd.d/tftp
        content: |
          service tftp
          {
              socket_type     = dgram
              protocol        = udp
              wait            = yes
              user            = root
              server          = /usr/sbin/in.tftpd
              server_args     = -s /var/lib/tftpboot
              disable         = no
          }
      notify: Restart xinetd

    - name: Create TFTP boot directory
      file:
        path: /var/lib/tftpboot
        state: directory
        mode: '0755'

    - name: Copy PXE boot files
      copy:
        src: /usr/share/syslinux/pxelinux.0
        dest: /var/lib/tftpboot/pxelinux.0

    - name: Configure HTTP server to serve installation media
      shell: |
        mkdir -p /var/www/html/centos
        mount -o loop /path/to/CentOS-Stream-9-latest-x86_64-dvd1.iso /var/www/html/centos
      args:
        creates: /var/www/html/centos

    - name: Configure firewall
      firewalld:
        service: "{{ item }}"
        permanent: true
        state: enabled
      loop:
        - dhcp
        - tftp
        - http
      notify: Reload firewalld

  handlers:
    - name: Restart xinetd
      service:
        name: xinetd
        state: restarted

    - name: Reload firewalld
      service:
        name: firewalld
        state: reloaded
```
`Ctrl+O zum speichern`
`Ctrl+X um zu schliessen`

# PXE Playbook ausf√ºhren
```bash
ansible-playbook -i /path/to/inventory pxe_setup.yml
```
