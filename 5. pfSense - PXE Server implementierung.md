# ISO Dateien auf pfsense transferieren

```powershell
ssh admin@192.168.100.2 mkdir -p /usr/local/www/iso
```
```powershell
cd C:\lab\vm\iso-images
```
```powershell
scp "C:\lab\vm\iso-images\*" admin@192.168.100.2:/usr/local/www/iso
```
```powershell
ssh admin@192.168.100.2 ls -l /usr/local/www/iso
```

# PXE Dienste

Ein PXE-Server (Preboot Execution Environment) benötigt mehrere wichtige Dienste, um das Netzwerk-Booten und die OS-Installation zu ermöglichen:

1. **DHCP-Server**: Stellt dem Client die Netzwerkkonfiguration bereit, wie z.B. die IP-Adresse, das Gateway und den Speicherort der Boot-Datei.

2. **TFTP-Server**: Überträgt die Boot-Dateien (z.B. `pxelinux.0`, `grubx64.efi`, `vmlinuz`, `initrd.img`) mithilfe des Trivial File Transfer Protocol an den Client.

3. **NFS-, HTTP- oder FTP-Server**: Hält die Installationsmedien des Betriebssystems oder Kickstart/Preseed-Dateien bereit, damit der Client die erforderlichen Dateien herunterladen kann, um die OS-Installation abzuschließen.

4. **Optional: DNS**: Nützlich, wenn die Installation oder Netzwerkkonfiguration eine Namensauflösung erfordert, aber nicht zwingend notwendig für ein grundlegendes PXE-Boot.

Diese Dienste arbeiten zusammen, um ein nahtloses Booten und Installieren über das Netzwerk zu ermöglichen.

## DHCP ist schon implementiert - bestätigen

```plaintext
webConfigurator http://192.168.100.2/
Services > DHCP Server > LAN
```

* General DHCP Options
  * Enable: `- [x] Enable DHCP server on LAN interface`
* Primary Address Pool: 
* Subnet: `192.168.100.0/24`
* Subnet Range: `192.168.100.1 - 192.168.100.254`
* Address Pool Range: `From 192.168.100.100 To 192.168.100.200`
* Server Options
  * DNS Servers: `1.1.1.1`
  * DNS Servers: `1.0.0.1`
* Other DHCP Options
  * TFTP > Display Advanced
    * TFTP Server: `192.168.100.2`
  * Network Booting > Display Advanced
    * Enable: `- [x] Enable Network Booting`
    * Next Server: `192.168.100.2`
    * Default BIOS File Name: `pxelinux.0`
    * UEFI 64 bit File Name: `efi/boot/grubx64.efi`
    * UEFI 64 bit File Name: `http://192.168.100.10/iso`
  * Custom DHCP Options > Display Advanced - ! Nicht nötig da wir oben die BIOS/EFI schon eingestellt haben !
    * Custom Option:
      * Number: `66`
      * Type: `Text`
      * Value: `192.168.100.2`
    * `+ Add Custom Option`
    * Custom Option:
      * Number: `67`
      * Type: `Text`
      * Value: Für BIOS: `pxelinux.0` Für EFI: `efi/boot/grubx64.efi`
 * Save
 * Apply Changes

Die BIOS-Clients erhalten automatisch `pxelinux.0`, und die EFI-Clients bekommen `efi/boot/grubx64.efi`, wie es in unsere Konfiguration vorgesehen ist. Der DHCP-Server erkennt automatisch, ob ein Client im BIOS- oder im EFI-Modus bootet, und sendet die entsprechende Boot-Datei. Deine Einstellungen sind korrekt.

Unser TFTP Server, welchen wir im nächsten Schritt implementieren werden, nutzt den Root Ordner: `/tftpboot/`
- `efi/boot/grubx64.efi` ist im absoluten Pfad: `/tftpboot/efi/boot/grubx64.efi`
- `pxelinux.0` ist im absoluten Pfad: `/tftpboot/pxelinux.0`

## TFTP implementieren

```plaintext
webConfigurator http://192.168.100.2/
System > Package Manager > Available Packages
```

* Search term: tftp
* Search
* Packages: tftpd
* `+ Install`
* Confirm

```plaintext
webConfigurator http://192.168.100.2/
Services > TFTP Server > Settings
```
* General Options
  * Enable TFTP service: `- [x] Check to enable the TFTP service.`
  * IPv4 Only:  `- [x] Check to allow clients to connect with IPv4 only.`
  * Logging: `- [x] Check to log read/write (RRQ/WRQ) requests.`
* Save

```plaintext
webConfigurator http://192.168.100.2/
Services > TFTP Server > Files
```
* Upload

TFTP Root Ordner wird standardmäßig dieser sein: `/tftpboot/`

# BIOS vs EFI Strukturen

## BIOS
- **BIOS Bootloader**: `pxelinux.0` wird im Verzeichnis `/tftpboot/` abgelegt.
  - **Pfad**: `/tftpboot/pxelinux.0`
- **BIOS Konfigurationsdatei**: Diese wird im Verzeichnis `/tftpboot/pxelinux.cfg/` gespeichert und heißt `default`.
  - **Pfad**: `/tftpboot/pxelinux.cfg/default`

## EFI
- **EFI Bootloader**: `grubx64.efi` wird im Verzeichnis `/tftpboot/efi/boot/` abgelegt.
  - **Pfad**: `/tftpboot/efi/boot/grubx64.efi`
- **EFI Konfigurationsdatei**: Diese wird ebenfalls im Verzeichnis `/tftpboot/efi/boot/` gespeichert und heißt `grub.cfg`.
  - **Pfad**: `/tftpboot/efi/boot/grub.cfg`

# BIOS vs EFI Strukturen erstellen

## BIOS
```powershell
ssh admin@192.168.100.2 mkdir -p /tftpboot/pxelinux.cfg/
```
```powershell
scp "D:\EFI\BOOT\grub.cfg" admin@192.168.100.2:/tftpboot/pxelinux.cfg/
```
```powershell
scp "D:\EFI\BOOT\grubx64.efi" admin@192.168.100.2:/tftpboot/pxelinux.cfg/
```

## EFI
```powershell
ssh admin@192.168.100.2 mkdir -p /tftpboot/efi/boot/
```
```powershell
ssh admin@192.168.100.2 touch /tftpboot/efi/boot/grub.cfg
```


